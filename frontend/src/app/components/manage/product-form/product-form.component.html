<div class="w-full">
  <h1 class="text-base text-center pt-3">
    @if (isEdit) { Edit Product } @else { Add New Product }
  </h1>

  <div class="p-[1px] w-full flex justify-center">
    <form
      class="w-full sm:w-[90%] md:w-[80%] lg:w-[70%] p-4 flex flex-col gap-4"
      [formGroup]="productForm"
      (ngSubmit)="isEdit ? updateProduct() : addProduct()"
    >
      <!-- Category -->
      <mat-form-field class="w-full">
        <mat-label>Category</mat-label>
        <mat-select formControlName="categoryId">
          @for (category of categories; track category._id) {
          <mat-option [value]="category._id">
            {{ category.name }}
          </mat-option>
          }
        </mat-select>
      </mat-form-field>

      <!-- Brand -->
      <mat-form-field class="w-full">
        <mat-label>Brand</mat-label>
        <mat-select formControlName="brandId">
          @for (brand of brands; track brand._id) {
          <mat-option [value]="brand._id">
            {{ brand.name }}
          </mat-option>
          }
        </mat-select>
      </mat-form-field>

      <!-- Product Name -->
      <mat-form-field class="w-full">
        <mat-label>Name</mat-label>
        <input matInput formControlName="name" placeholder="Ex. Laptop" />
        <mat-error>
          @if (productForm.get('name')?.invalid &&
          productForm.get('name')?.touched) { Name is required (min 5
          characters). }
        </mat-error>
      </mat-form-field>

      <!-- Short Description -->
      <mat-form-field class="w-full">
        <mat-label>Short Description</mat-label>
        <input
          matInput
          formControlName="shortDescription"
          placeholder="Write short description"
        />
        <mat-error>
          @if (productForm.get('shortDescription')?.invalid &&
          productForm.get('shortDescription')?.touched) { Short description is
          required (min 10 characters). }
        </mat-error>
      </mat-form-field>

      <!-- Description -->
      <mat-form-field class="w-full">
        <mat-label>Description</mat-label>
        <textarea
          matInput
          formControlName="description"
          placeholder="Write description"
          rows="5"
        ></textarea>
        <mat-error>
          @if (productForm.get('description')?.invalid &&
          productForm.get('description')?.touched) { Description is required
          (min 50 characters). }
        </mat-error>
      </mat-form-field>

      <!-- Price & Discount -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <mat-form-field class="w-full">
          <mat-label>Price</mat-label>
          <input
            matInput
            type="number"
            formControlName="price"
            placeholder="Enter price"
          />
          <mat-error>
            @if (productForm.get('price')?.invalid &&
            productForm.get('price')?.touched) { Price is required. }
          </mat-error>
        </mat-form-field>

        <mat-form-field class="w-full">
          <mat-label>Discount</mat-label>
          <input
            matInput
            type="number"
            formControlName="discount"
            placeholder="Enter discount"
          />
        </mat-form-field>
      </div>

      <!-- Images FormArray -->
      <div formArrayName="images" class="flex flex-col gap-3">
        <div class="flex justify-between items-center">
          <h3 class="text-lg font-semibold">Product Images</h3>
          <button
            mat-raised-button
            color="primary"
            type="button"
            (click)="addImage()"
          >
            Add Image
          </button>
        </div>

        <div class="overflow-x-auto">
          <table
            class="min-w-full border border-gray-300 rounded-lg text-sm sm:text-base"
          >
            <thead class="bg-gray-100">
              <tr>
                <th class="p-2 border">#</th>
                <th class="p-2 border text-left">Image URL</th>
                <th class="p-2 border">Action</th>
              </tr>
            </thead>
            <tbody>
              @for (item of images.controls; track $index) {
              <tr>
                <td class="p-2 border text-center">{{ $index + 1 }}</td>
                <td class="p-2 border">
                  <mat-form-field appearance="outline" class="w-full">
                    <mat-label>Image {{ $index + 1 }}</mat-label>
                    <input
                      matInput
                      [formControlName]="$index"
                      placeholder="Enter image URL"
                    />
                  </mat-form-field>
                </td>
                <td class="p-2 border text-center">
                  <button
                    mat-raised-button
                    color="warn"
                    type="button"
                    (click)="removeImage($index)"
                  >
                    Remove
                  </button>
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
      </div>

      <!-- Submit -->
      <div class="flex justify-center w-full mt-4">
        <button
          mat-raised-button
          color="accent"
          type="submit"
          [disabled]="productForm.invalid"
        >
          {{ isEdit ? "Update" : "Save" }}
        </button>
      </div>
    </form>
  </div>
</div>
